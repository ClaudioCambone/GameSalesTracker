<!DOCTYPE html>
<html>

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <%= stylesheet_link_tag 'cards', media: 'all' %>
  <%= stylesheet_link_tag 'application', media: 'all' %>
</head>

<body>
  <% per_page = 9 %> <!-- Imposta il numero desiderato di risultati per pagina -->

  <div class="container">
    <% if @games.present? %>
    <br><br>
    <div class="row row-cols-1 row-cols-md-3">
      <% displayed_titles = Set.new %>
      <% @games.each do |game| %>
        <% title = game['title'] %>
        <% unless displayed_titles.include?(title) %>
        <div class="col mb-4">
          <div class="card">
            <div class="image-container">
              <%= image_tag(game['image_url'] || 'noimage.png', class: 'card-img-top img-fluid', alt: title) %>
            </div>
            <div class="card-body">
              <h5 class="card-title"><%= title %></h5>
              <p class="card-text">Prezzo Attuale: <%= "%.2f" % game['price_new'] %> â‚¬</p>
              <%= link_to 'Dettagli', details_game_path(plain: game['plain']), class: 'btn btn-primary' %>
            </div>
          </div>
        </div>
        <% displayed_titles.add(title) %>
        <% end %>
      <% end %>
    </div>

    <!-- Aggiunta della Paginazione -->
    <% if @games.size == per_page %>
      <% next_page = params[:page].to_i + 1 %>
      <%= link_to "Carica Altri", search_games_path(search_query: params[:search_query], page: next_page), remote: true, class: "text-white-50" %>
    <% end %>

    <% else %>
      <p>Risultati della ricerca:</p>
      <p>Nessun risultato trovato.</p>
    <% end %>
  </div>

  <!-- Aggiunta della Paginazione -->
  <%= paginate @games %>

</body>

</html>